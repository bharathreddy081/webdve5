"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _repl = _interopRequireDefault(require("@wdio/repl"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class WDIORunnerRepl extends _repl.default {
  constructor(childProcess, options) {
    super(options);
    this.childProcess = childProcess;
  }

  _getError(params) {
    if (!params.error) {
      return null;
    }

    const err = new Error(params.message);
    err.stack = params.stack;
    return err;
  }

  eval(cmd, context, filename, callback) {
    if (this.commandIsRunning) {
      return;
    }

    this.commandIsRunning = true;
    this.childProcess.send({
      origin: 'debugger',
      name: 'eval',
      content: {
        cmd
      }
    });
    this.callback = callback;
  }

  onResult(params) {
    const error = this._getError(params);

    this.callback(error, params.result);
    this.commandIsRunning = false;
  }

}

exports.default = WDIORunnerRepl;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9yZXBsLmpzIl0sIm5hbWVzIjpbIldESU9SdW5uZXJSZXBsIiwiV0RJT1JlcGwiLCJjb25zdHJ1Y3RvciIsImNoaWxkUHJvY2VzcyIsIm9wdGlvbnMiLCJfZ2V0RXJyb3IiLCJwYXJhbXMiLCJlcnJvciIsImVyciIsIkVycm9yIiwibWVzc2FnZSIsInN0YWNrIiwiZXZhbCIsImNtZCIsImNvbnRleHQiLCJmaWxlbmFtZSIsImNhbGxiYWNrIiwiY29tbWFuZElzUnVubmluZyIsInNlbmQiLCJvcmlnaW4iLCJuYW1lIiwiY29udGVudCIsIm9uUmVzdWx0IiwicmVzdWx0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7OztBQUVlLE1BQU1BLGNBQU4sU0FBNkJDLGFBQTdCLENBQXNDO0FBQ2pEQyxFQUFBQSxXQUFXLENBQUVDLFlBQUYsRUFBZ0JDLE9BQWhCLEVBQXlCO0FBQ2hDLFVBQU1BLE9BQU47QUFDQSxTQUFLRCxZQUFMLEdBQW9CQSxZQUFwQjtBQUNIOztBQUVERSxFQUFBQSxTQUFTLENBQUNDLE1BQUQsRUFBUztBQUNkLFFBQUksQ0FBQ0EsTUFBTSxDQUFDQyxLQUFaLEVBQW1CO0FBQ2YsYUFBTyxJQUFQO0FBQ0g7O0FBRUQsVUFBTUMsR0FBRyxHQUFHLElBQUlDLEtBQUosQ0FBVUgsTUFBTSxDQUFDSSxPQUFqQixDQUFaO0FBQ0FGLElBQUFBLEdBQUcsQ0FBQ0csS0FBSixHQUFZTCxNQUFNLENBQUNLLEtBQW5CO0FBQ0EsV0FBT0gsR0FBUDtBQUNIOztBQUVESSxFQUFBQSxJQUFJLENBQUVDLEdBQUYsRUFBT0MsT0FBUCxFQUFnQkMsUUFBaEIsRUFBMEJDLFFBQTFCLEVBQW9DO0FBQ3BDLFFBQUksS0FBS0MsZ0JBQVQsRUFBMkI7QUFDdkI7QUFDSDs7QUFFRCxTQUFLQSxnQkFBTCxHQUF3QixJQUF4QjtBQUNBLFNBQUtkLFlBQUwsQ0FBa0JlLElBQWxCLENBQXVCO0FBQ25CQyxNQUFBQSxNQUFNLEVBQUUsVUFEVztBQUVuQkMsTUFBQUEsSUFBSSxFQUFFLE1BRmE7QUFHbkJDLE1BQUFBLE9BQU8sRUFBRTtBQUFFUixRQUFBQTtBQUFGO0FBSFUsS0FBdkI7QUFNQSxTQUFLRyxRQUFMLEdBQWdCQSxRQUFoQjtBQUNIOztBQUVETSxFQUFBQSxRQUFRLENBQUVoQixNQUFGLEVBQVU7QUFDZCxVQUFNQyxLQUFLLEdBQUcsS0FBS0YsU0FBTCxDQUFlQyxNQUFmLENBQWQ7O0FBQ0EsU0FBS1UsUUFBTCxDQUFjVCxLQUFkLEVBQXFCRCxNQUFNLENBQUNpQixNQUE1QjtBQUNBLFNBQUtOLGdCQUFMLEdBQXdCLEtBQXhCO0FBQ0g7O0FBbkNnRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBXRElPUmVwbCBmcm9tICdAd2Rpby9yZXBsJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBXRElPUnVubmVyUmVwbCBleHRlbmRzIFdESU9SZXBsIHtcbiAgICBjb25zdHJ1Y3RvciAoY2hpbGRQcm9jZXNzLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKG9wdGlvbnMpXG4gICAgICAgIHRoaXMuY2hpbGRQcm9jZXNzID0gY2hpbGRQcm9jZXNzXG4gICAgfVxuXG4gICAgX2dldEVycm9yKHBhcmFtcykge1xuICAgICAgICBpZiAoIXBhcmFtcy5lcnJvcikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGVyciA9IG5ldyBFcnJvcihwYXJhbXMubWVzc2FnZSlcbiAgICAgICAgZXJyLnN0YWNrID0gcGFyYW1zLnN0YWNrXG4gICAgICAgIHJldHVybiBlcnJcbiAgICB9XG5cbiAgICBldmFsIChjbWQsIGNvbnRleHQsIGZpbGVuYW1lLCBjYWxsYmFjaykge1xuICAgICAgICBpZiAodGhpcy5jb21tYW5kSXNSdW5uaW5nKSB7XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuY29tbWFuZElzUnVubmluZyA9IHRydWVcbiAgICAgICAgdGhpcy5jaGlsZFByb2Nlc3Muc2VuZCh7XG4gICAgICAgICAgICBvcmlnaW46ICdkZWJ1Z2dlcicsXG4gICAgICAgICAgICBuYW1lOiAnZXZhbCcsXG4gICAgICAgICAgICBjb250ZW50OiB7IGNtZCB9XG4gICAgICAgIH0pXG5cbiAgICAgICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrXG4gICAgfVxuXG4gICAgb25SZXN1bHQgKHBhcmFtcykge1xuICAgICAgICBjb25zdCBlcnJvciA9IHRoaXMuX2dldEVycm9yKHBhcmFtcylcbiAgICAgICAgdGhpcy5jYWxsYmFjayhlcnJvciwgcGFyYW1zLnJlc3VsdClcbiAgICAgICAgdGhpcy5jb21tYW5kSXNSdW5uaW5nID0gZmFsc2VcbiAgICB9XG59XG4iXX0=